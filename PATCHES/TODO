TODO
================================================================================

getboottime()
	- needs  G_ and V_ variant and applied correctly in the right places.
	- failed/xdr
	- xhr,  sys/sys/time.h

hostid?

failed/xej	sysv_msg ...
failed/xek	sysv_sem ...
failed/xel	sysy_shm ...
	}}} all three need proper OSD save/restore if we keep it?

xes -> vfs_cache.c needs review;  just applied blindly so far.
	- compiles now :)

Lots of &prison0 vs. V_prison0  (no &)  but only in some places;  check that!
	- the osd calls take the prison0 argument twice; check those still


vps_pager_getpages()



------------------------------------------
panic while just sitting in a vps shell for a while not doing anything;
I guess it's a lock leak in an error case?

root@rabbit3:~ # spin lock 0xffffffff81cdd700 (sched lock 0) held by 0xfffff80007731000 (tid 100003) too long
panic: spin lock held too long
cpuid = 3
time = 1501167600
KDB: stack backtrace:
db_trace_self_wrapper() at db_trace_self_wrapper+0x2b/frame 0xfffffe085f7cd3c0
vpanic() at vpanic+0x19c/frame 0xfffffe085f7cd440
panic() at panic+0x43/frame 0xfffffe085f7cd4a0
_mtx_lock_spin_cookie() at _mtx_lock_spin_cookie+0x328/frame 0xfffffe085f7cd520
__mtx_lock_spin_flags() at __mtx_lock_spin_flags+0xe0/frame 0xfffffe085f7cd560
sched_add() at sched_add+0xe4/frame 0xfffffe085f7cd5a0
setrunnable() at setrunnable+0x90/frame 0xfffffe085f7cd5c0
sleepq_broadcast() at sleepq_broadcast+0xe8/frame 0xfffffe085f7cd600
wakeupshlk() at wakeupshlk+0x168/frame 0xfffffe085f7cd650
__lockmgr_args() at __lockmgr_args+0x82e/frame 0xfffffe085f7cd6f0
lockmgr_unlock_fast_path() at lockmgr_unlock_fast_path+0x184/frame 0xfffffe085f7cd740
VOP_UNLOCK_APV() at VOP_UNLOCK_APV+0xe0/frame 0xfffffe085f7cd770
vn_statfile() at vn_statfile+0x72/frame 0xfffffe085f7cd7c0
kern_fstat() at kern_fstat+0xa8/frame 0xfffffe085f7cd810
freebsd11_fstat() at freebsd11_fstat+0x1d/frame 0xfffffe085f7cd980
amd64_syscall() at amd64_syscall+0x859/frame 0xfffffe085f7cdab0
Xfast_syscall() at Xfast_syscall+0x104/frame 0xfffffe085f7cdab0
--- syscall (0, FreeBSD ELF64, nosys), rip = 0x800638fca, rsp = 0x7fffffffd0e8, rbp = 0x7fffffffd190 ---
KDB: enter: panic
[ thread pid 991 tid 100086 ]
Stopped at      kdb_enter+0x3b: movq    $0,kdb_why

------------------------------------------

vpsctl suspend work, on resume we got this:

root@rabbit3:~ # vps_suspend_relink_delete: get_next_dirent() error=2
panic: mutex process lock not owned at /tank/users/bz/vps_zambcom/vps_zabcom/sys/kern/kern_thread.c:1123
cpuid = 3
time = 1501241665
KDB: stack backtrace:
db_trace_self_wrapper() at db_trace_self_wrapper+0x2b/frame 0xfffffe085f8994a0
vpanic() at vpanic+0x19c/frame 0xfffffe085f899520
panic() at panic+0x43/frame 0xfffffe085f899580
__mtx_assert() at __mtx_assert+0xb4/frame 0xfffffe085f899590
thread_unsuspend() at thread_unsuspend+0x2a/frame 0xfffffe085f8995c0
vps_resume() at vps_resume+0x202/frame 0xfffffe085f899660
vps_ioc_resume() at vps_ioc_resume+0xdc/frame 0xfffffe085f899690
devfs_ioctl() at devfs_ioctl+0xc0/frame 0xfffffe085f8996e0
VOP_IOCTL_APV() at VOP_IOCTL_APV+0xe0/frame 0xfffffe085f899710
vn_ioctl() at vn_ioctl+0x124/frame 0xfffffe085f899820
devfs_ioctl_f() at devfs_ioctl_f+0x1f/frame 0xfffffe085f899840
kern_ioctl() at kern_ioctl+0x2cd/frame 0xfffffe085f8998a0
sys_ioctl() at sys_ioctl+0x16f/frame 0xfffffe085f899980
amd64_syscall() at amd64_syscall+0x859/frame 0xfffffe085f899ab0
Xfast_syscall() at Xfast_syscall+0x104/frame 0xfffffe085f899ab0
--- syscall (54, FreeBSD ELF64, sys_ioctl), rip = 0x8009ba6da, rsp = 0x7fffffffe948, rbp = 0x7fffffffea90 ---
KDB: enter: panic
[ thread pid 905 tid 100124 ]
Stopped at      kdb_enter+0x3b: movq    $0,kdb_why

------------------------------------------





# end
